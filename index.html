<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FurBaza — каталог фурсьют-шопов</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text','SF Pro Display',Inter,Segoe UI,Roboto,system-ui; background:#111; color:#fff; }
.card { border-radius:1.25rem; background:#1c1c1e; overflow:hidden; border:1px solid rgba(255,255,255,.06); transition: transform .15s; }
.card:hover { transform: translateY(-2px); }
.card img { width:100%; height:auto; display:block; object-fit:cover; max-height:300px; }
.btn { border-radius:14px; padding:.5rem 1rem; background:#0a84ff; color:#fff; font-weight:600; text-align:center; display:block; }
.btn-secondary { border-radius:14px; padding:.5rem 1rem; background:#333; color:#fff; text-align:center; display:block; }
.search { width:100%; padding:.7rem 1rem; border-radius:14px; background:#1c1c1e; border:1px solid rgba(255,255,255,.08); color:#fff; margin-bottom:1rem; }
.flex-gap { display:flex; gap:0.5rem; }
.price { color:#4ade80; font-weight:600; margin-top:.25rem; }
</style>
</head>
<body>
<header class="p-4 flex justify-between items-center bg-gray-900">
<h1 class="text-xl font-bold">FurBaza</h1>
<a href="https://t.me/FurBaza" target="_blank" class="btn">Наш Telegram</a>
</header>
<main class="max-w-5xl mx-auto p-4">
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
<input id="cityInput" class="search" type="text" placeholder="Поиск по городу...">
<div class="flex-gap">
<button id="sortAsc" class="btn-secondary">Цена ↑</button>
<button id="sortDesc" class="btn-secondary">Цена ↓</button>
</div>
</div>
<div id="shopsGrid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
<p id="empty" class="mt-6 text-center text-gray-400 hidden">Ничего не найдено</p>
</main>

<template id="shopCardTpl">
<article class="card flex flex-col">
<img>
<div class="p-3 flex-1 flex flex-col justify-between">
<div>
<h2 class="font-semibold text-lg"></h2>
<p class="text-gray-300 text-sm mt-1"></p>
<p class="price"></p>
</div>
<div class="flex gap-2 mt-2">
<a class="btn-secondary" target="_blank">В магазин</a>
<a class="btn" href="https://t.me/FurBaza" target="_blank">Telegram</a>
</div>
</div>
</article>
</template>

<script>
const shopsGrid = document.getElementById('shopsGrid');
const empty = document.getElementById('empty');
const cityInput = document.getElementById('cityInput');
const sortAscBtn = document.getElementById('sortAsc');
const sortDescBtn = document.getElementById('sortDesc');

async function loadShops(){
  const res = await fetch('shops/list.json');
  const files = await res.json();
  const shops = [];
  for(const f of files){
    const html = await (await fetch('shops/'+f)).text();
    const doc = new DOMParser().parseFromString(html,'text/html');
    const json = doc.querySelector('#shop');
    if(json){
      const data = JSON.parse(json.textContent);
      shops.push(data);
    }
  }
  return shops;
}

function parsePrice(p){ if(!p) return 0; return parseInt(p.replace(/\D/g,''))||0; }

function render(shops, filter=''){
  const filtered = shops.filter(s=>s.city.toLowerCase().includes(filter.toLowerCase()));
  shopsGrid.innerHTML='';
  if(!filtered.length){ empty.classList.remove('hidden'); return; }
  empty.classList.add('hidden');
  const tpl = document.getElementById('shopCardTpl');
  filtered.forEach(s=>{
    const card = tpl.content.firstElementChild.cloneNode(true);
    card.querySelector('h2').textContent = s.name||'';
    card.querySelector('p').textContent = s.description||'';
    card.querySelector('.price').textContent = s.price||'';
    const img = card.querySelector('img');
    img.src = s.image ? 'photo/'+s.image : '';
    img.alt = s.name||'';
    card.querySelectorAll('a')[0].href = s.url||'#';
    shopsGrid.appendChild(card);
  });
}

(async function(){
  window.__shops = await loadShops();
  render(window.__shops);
  cityInput.addEventListener('input', ()=>render(window.__shops, cityInput.value));
  sortAscBtn.addEventListener('click', ()=>{ window.__shops.sort((a,b)=>parsePrice(a.price)-parsePrice(b.price)); render(window.__shops, cityInput.value); });
  sortDescBtn.addEventListener('click', ()=>{ window.__shops.sort((a,b)=>parsePrice(b.price)-parsePrice(a.price)); render(window.__shops, cityInput.value); });
})();
</script>
</body>
</html>

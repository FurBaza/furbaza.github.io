<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FurBaza — каталог фурсьют‑шопов</title>
  <meta name="description" content="Фурсьют‑шопы по городам России. Поиск, топ и быстрый переход в магазин или наш Telegram @FurBaza.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    html,body { background:#0b0b0c; color:#fff; font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','SF Pro Display',Inter,Segoe UI,Roboto,system-ui; }
    .glass { background: rgba(28,28,30,.72); backdrop-filter: saturate(180%) blur(16px); border:1px solid rgba(255,255,255,.06); }
    .chip { border-radius:9999px; padding:.35rem .8rem; background:#1c1c1e; border:1px solid rgba(255,255,255,.06); }
    .btn { border-radius: 14px; padding:.6rem 1rem; background:#0a84ff; color:#fff; font-weight:600; }
    .btn-secondary { background:#1c1c1e; color:#fff; border:1px solid rgba(255,255,255,.08); }
    .card { border-radius: 22px; overflow:hidden; background:#111114; border:1px solid rgba(255,255,255,.06); transition: transform .12s ease; }
    .card:hover { transform: translateY(-2px); }
    .shadow-soft { box-shadow: 0 8px 30px rgba(0,0,0,.35); }
    .search { border-radius: 14px; background:#1c1c1e; border:1px solid rgba(255,255,255,.08); color:#fff; }
    .tag { font-size:.75rem; opacity:.8; }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <header class="sticky top-0 z-40 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-2xl bg-gradient-to-br from-indigo-500 to-fuchsia-500 shadow-soft"></div>
        <span class="text-lg font-semibold tracking-tight">FurBaza</span>
      </div>
      <nav class="ml-auto flex items-center gap-2">
        <a href="https://t.me/FurBaza" target="_blank" rel="noopener" class="btn">Наш Telegram</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 pt-8 pb-4">
    <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">Каталог фурсьют‑шопов</h1>
    <p class="mt-2 text-zinc-300/80">Вводи город (Москва, Санкт‑Петербург, Казань и т.д.) — кликай по карточке, чтобы перейти.</p>

    <div class="mt-5 grid sm:grid-cols-[1fr_auto] gap-3">
      <input id="cityInput" type="search" placeholder="Поиск по городу…" class="search w-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500/60">
      <div class="flex gap-2">
        <button id="filterTop" class="chip">Топ</button>
        <button id="filterAll" class="chip">Все</button>
      </div>
    </div>
  </section>

  <!-- Grid -->
  <main class="max-w-6xl mx-auto px-4 pb-24">
    <h2 class="text-xl font-semibold mb-3">Магазины</h2>
    <div id="shopsGrid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    <div id="emptyState" class="hidden mt-12 text-center text-zinc-400">
      <p class="text-lg">Ничего не найдено. Измени запрос или добавь новые магазины в <code>/shops</code>.</p>
    </div>
  </main>

  <footer class="border-t border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-8 flex flex-col sm:flex-row gap-3 items-center justify-between">
      <p class="text-sm text-zinc-400">© <span id="year"></span> FurBaza. Сделано с ❤️ для фурри‑комьюнити.</p>
      <a href="https://t.me/FurBaza" target="_blank" rel="noopener" class="btn-secondary chip">Написать нам в Telegram</a>
    </div>
  </footer>

  <template id="shopCardTpl">
    <article class="card shadow-soft overflow-hidden flex flex-col">
      <a class="block" target="_blank" rel="noopener">
        <div class="aspect-[16/10] w-full overflow-hidden bg-zinc-900">
          <img class="w-full h-full object-cover" loading="lazy" />
        </div>
      </a>
      <div class="p-4 flex-1 flex flex-col">
        <div class="flex items-start justify-between gap-2">
          <div>
            <h3 class="text-lg font-semibold leading-tight"></h3>
            <p class="text-sm text-zinc-300/80 mt-1"></p>
          </div>
          <span class="tag shrink-0 px-2 py-1 rounded-full bg-zinc-800 border border-white/10"></span>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-2">
          <a class="btn-secondary text-center py-2" target="_blank" rel="noopener">В магазин</a>
          <a class="btn text-center py-2" href="https://t.me/FurBaza" target="_blank" rel="noopener">Telegram</a>
        </div>
      </div>
    </article>
  </template>

<script>
const $ = (s, el=document)=>el.querySelector(s);
const shopsGrid = $('#shopsGrid');
const emptyState = $('#emptyState');
const cityInput = $('#cityInput');
const filterTopBtn = $('#filterTop');
const filterAllBtn = $('#filterAll');
$('#year').textContent = new Date().getFullYear();

// Detect repo (for GitHub API listing). Fallback to /shops/list.json for local/custom domains.
async function detectRepo(){
  const {host, pathname} = window.location;
  const parts = pathname.replace(/^\//,'').split('/');
  if(host.endsWith('github.io') && parts[0]){
    return {owner: host.split('.')[0], repo: parts[0]};
  }
  return null;
}

async function listShopFiles(){
  const repo = await detectRepo();
  if(repo){
    try{
      const res = await fetch(`https://api.github.com/repos/${repo.owner}/${repo.repo}/contents/shops`);
      if(!res.ok) throw new Error('GitHub API error');
      const data = await res.json();
      return data.filter(x => x.type === 'file' && x.name.endsWith('.html')).map(x => `shops/${x.name}`);
    }catch(e){/* fallback below */}
  }
  try{
    const res = await fetch('shops/list.json', {cache:'no-store'});
    if(!res.ok) throw new Error();
    const arr = await res.json();
    return arr.map(n => `shops/${n}`);
  }catch(e){
    return [];
  }
}

async function loadShopMeta(path){
  try{
    const html = await (await fetch(path, {cache:'no-store'})).text();
    const doc = new DOMParser().parseFromString(html, 'text/html');
    const json = doc.querySelector('#shop');
    if(!json) throw new Error('No #shop meta');
    const meta = JSON.parse(json.textContent.trim());
    return { ...meta, _path: path };
  }catch(e){
    console.warn('Meta read failed:', path, e);
    return null;
  }
}

function renderShops(items){
  shopsGrid.innerHTML = '';
  if(!items.length){ emptyState.classList.remove('hidden'); return; }
  emptyState.classList.add('hidden');
  const tpl = $('#shopCardTpl');
  for(const s of items){
    const card = tpl.content.firstElementChild.cloneNode(true);
    const link = card.querySelector('a.block');
    const img = card.querySelector('img');
    const h3 = card.querySelector('h3');
    const p = card.querySelector('p');
    const tag = card.querySelector('.tag');
    const btnShop = card.querySelectorAll('a')[1-1]; // first button is link block; but we added separate buttons
    // Fix: select buttons explicitly
    const btns = card.querySelectorAll('.grid a');
    const btnGo = btns[0];
    const btnTg = btns[1];

    link.href = s.url || s._path;
    img.src = s.image || 'shops/placeholder.jpg';
    img.alt = s.name || 'Магазин';

    h3.textContent = s.name || 'Без названия';
    p.textContent = s.description || '';
    tag.textContent = s.city || 'Город';

    btnGo.href = s.url || s._path;
    // btnTg already points to @FurBaza

    shopsGrid.appendChild(card);
  }
}

function applyFilters(){
  const q = cityInput.value.trim().toLowerCase();
  const onlyTop = filterTopBtn.dataset.active === '1';
  let res = window.__shops.slice();
  if(q){ res = res.filter(s => (s.city||'').toLowerCase().includes(q)); }
  if(onlyTop){ res = res.filter(s => !!s.top); }
  renderShops(res);
}

cityInput.addEventListener('input', applyFilters);
filterTopBtn.addEventListener('click', ()=>{
  filterTopBtn.dataset.active='1';
  filterAllBtn.dataset.active='';
  applyFilters();
});
filterAllBtn.addEventListener('click', ()=>{
  filterTopBtn.dataset.active='';
  filterAllBtn.dataset.active='1';
  applyFilters();
});

(async function init(){
  // By default show All
  filterAllBtn.dataset.active='1';
  const paths = await listShopFiles();
  const metas = (await Promise.all(paths.map(loadShopMeta))).filter(Boolean);
  metas.sort((a,b)=> (b.top?1:0)-(a.top?1:0) || (a.name||'').localeCompare(b.name||''));
  window.__shops = metas;
  applyFilters();
})();
</script>

<!--
ИНСТРУКЦИЯ (коротко):
1) Клади файлы магазинов в /shops/*.html
2) В каждом файле должен быть <script id="shop" type="application/json">{...}</script> с полями:
   name, city, url, image, description (необяз.), top (true/false)
3) На GitHub Pages список подтянется сам. Для локального запуска/кастом домена создай /shops/list.json:
   ["moscow.html","spb.html"]
-->
</body>
</html>
